CREATE TABLE `category` (
  `id` smallint(6) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `name` varchar(50) NOT NULL DEFAULT '' COMMENT '分类名称',
  PRIMARY KEY (`id`),
  KEY `idx_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `goods` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',
  `name` varchar(50) NOT NULL DEFAULT '' COMMENT '商品名称',
  `number` int(11) NOT NULL DEFAULT '0' COMMENT '库存数量',
  `category` smallint(6) NOT NULL DEFAULT '0' COMMENT '分类',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_name` (`name`),
  KEY `idx_category` (`category`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `item` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',
  `order_id` bigint(20) NOT NULL DEFAULT '0' COMMENT '订单id',
  `goods_id` int(11) NOT NULL DEFAULT '0' COMMENT '商品id',
  `goods_number` int(11) NOT NULL DEFAULT '0' COMMENT '商品数量',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_order_id_created_at` (`order_id`,`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `log` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `time` bigint(20) NOT NULL DEFAULT '0' COMMENT '时间戳',
  `application` varchar(50) NOT NULL DEFAULT '0' COMMENT '应用名称',
  `thread` varchar(255) NOT NULL DEFAULT '0' COMMENT '线程名称',
  `level` varchar(25) NOT NULL DEFAULT '0' COMMENT '级别',
  `logger` varchar(500) NOT NULL DEFAULT '0' COMMENT '日志类名',
  `method` varchar(255) NOT NULL DEFAULT '0' COMMENT '方法名称',
  `line_number` int(11) NOT NULL DEFAULT '0' COMMENT '行号',
  `message` longtext COMMENT '日志信息',
  `cost` int(11) NOT NULL DEFAULT '-1' COMMENT '耗时',
  `request_id` char(32) NOT NULL DEFAULT '0' COMMENT '请求id',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `order` (
  `id` bigint(20) NOT NULL COMMENT '主键(订单号)',
  `operator` int(11) NOT NULL DEFAULT '0' COMMENT '操作人',
  `status` tinyint(4) NOT NULL DEFAULT '0' COMMENT '订单状态',
  `username` varchar(50) NOT NULL DEFAULT '' COMMENT '客户姓名',
  `phone` varchar(25) NOT NULL DEFAULT '' COMMENT '客户电话号',
  `address` varchar(1000) NOT NULL DEFAULT '' COMMENT '送货地址',
  `total_amount` decimal(10,2) NOT NULL DEFAULT '0.00' COMMENT '订单总金额',
  `remark` varchar(1000) NOT NULL DEFAULT '' COMMENT '订单备注',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `stock_log` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',
  `operator` int(11) NOT NULL DEFAULT '0' COMMENT '操作人',
  `type` tinyint(4) NOT NULL DEFAULT '0' COMMENT '类型',
  `type_detail` tinyint(4) NOT NULL DEFAULT '0' COMMENT '详细操作类型',
  `goods_id` int(11) NOT NULL DEFAULT '0' COMMENT '商品id',
  `goods_number` int(11) NOT NULL DEFAULT '0' COMMENT '商品数量',
  `order_id` bigint(20) NOT NULL DEFAULT '0' COMMENT '订单id',
  `remark` varchar(1000) NOT NULL DEFAULT '' COMMENT '备注信息',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_goods_id` (`goods_id`),
  KEY `idx_order_id` (`order_id`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `user` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL DEFAULT '0' COMMENT '姓名',
  `password` varchar(50) NOT NULL DEFAULT '0' COMMENT '密码',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uniq_username` (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `message_queue` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `topic` varchar(255) NOT NULL DEFAULT '' COMMENT 'kafka topic',
  `source` varchar(255) NOT NULL DEFAULT '' COMMENT '消费业务线',
  `message_id` varchar(35) NOT NULL DEFAULT '' COMMENT '消息id',
  `message_content` longtext COMMENT '消息体',
  `message_status` smallint(6) NOT NULL DEFAULT '-1' COMMENT '消息状态(0:待消费, 1:开始消费, 2:消费成功, 3:消费失败)',
  `error_message` varchar(255) NOT NULL DEFAULT '' COMMENT '错误信息',
  `request_id` varchar(35) NOT NULL DEFAULT '' COMMENT '请求id',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '消息创建时间',
  `consume_at` timestamp NOT NULL DEFAULT '1970-01-01 08:00:01' COMMENT '消息消费时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '记录更改时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='mq落地';

